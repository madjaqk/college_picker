<!DOCTYPE html>
<html>
<head>
	<title>College Finder</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script>
		$(document).ready(function(){
			
			$("#generate").click(function() {
				var regions = []
				$("input[name='region']").each( function() {
					if($(this).is(":checked")) { regions.push($(this).val()) }
				})
				console.log(regions)

				reading = $("#reading_sat").val()
				math = $("#math_sat").val()

				url = "https://api.data.gov/ed/collegescorecard/v1/schools?fields=school.name,id,2013.admissions.sat_scores.midpoint.math,2013.admissions.sat_scores.midpoint.critical_reading,2013.admissions.sat_scores.midpoint.writing"
				if(regions.length > 0) {
					url += "&school.region_id=" + regions.join(",")
				}
				if(math) {
					url += "&2013.admissions.sat_scores.midpoint.math__range=.." + math
				} 
				if(reading) {
					url += "&2013.admissions.sat_scores.midpoint.critical_reading__range=.." + reading
				}
				
				url += "&_per_page=100&api_key=80Iv1QF5ejtA5Hj8GzHCX8i3Lg3ERCAgkeo7lQjq"
				$.get(url, function(res) {
					schools = res["results"];
					schools.sort(function(a, b) {
						var a_sum = a["2013.admissions.sat_scores.midpoint.math"] + a["2013.admissions.sat_scores.midpoint.critical_reading"];
						var b_sum = b["2013.admissions.sat_scores.midpoint.math"] + b["2013.admissions.sat_scores.midpoint.critical_reading"];
						return b_sum - a_sum
					});
					$(".school_list").html("<ol id='schools'>")
					for(var i = 0; i < schools.length; i++){
						output = "<li>"
						output += schools[i]["school.name"]
						output += " -- "
						output += schools[i]["2013.admissions.sat_scores.midpoint.math"] + schools[i]["2013.admissions.sat_scores.midpoint.critical_reading"]
						output += ` (${schools[i]["2013.admissions.sat_scores.midpoint.math"]} math, ${schools[i]["2013.admissions.sat_scores.midpoint.critical_reading"]} reading)`
						output += "</li>"
						$("#schools").append(output)
					}
					$(".school_list").append("</ol>")
				});
			});
		});
	</script>
</head>
<body>
	<div class="input_fields">
		<p>Math SAT score: <input type="text" id="math_sat"></p>
		<p>Critical reading SAT score: <input type="text" id="reading_sat"></p>
		Region of School<br>
	    <input type='checkbox' name='region' value='1'>New England<br>
	    <input type='checkbox' name='region' value='2'>Mid East<br>
	    <input type='checkbox' name='region' value='3'>Great Lakes<br>
	    <input type='checkbox' name='region' value='4'>Plains<br>
	    <input type='checkbox' name='region' value='5'>Southeast<br>
	    <input type='checkbox' name='region' value='6'>Southwest<br>
	    <input type='checkbox' name='region' value='7'>Rocky Mountains<br>
	    <input type='checkbox' name='region' value='8'>Far West<br>
	    <input type='checkbox' name='region' value='9'>Outlying Areas<br>
		<button id="generate">Generate list</button>
	</div>
	<div class="school_list">
	</div>
</body>
</html>